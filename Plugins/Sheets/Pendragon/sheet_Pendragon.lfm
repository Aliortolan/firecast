<?xml version="1.0" encoding="UTF-8"?>
<form formType="sheetTemplate" dataType="thirteen.Pendragon" title="Pendragon 5.2" name="frmPendragon" theme="dark">
	<script>
	<![CDATA[
		function CalcularGloriaAnual()
			local node = NDB.getRoot(sheet);
			local SomaHabs = 0;
			local SomaVirts = 0;
			local SomaBonus = 0;
			
			-- INDEXANDO HABILIDADES
			local tbHabilidades = {
				{sheet.fldCBHab01, sheet.fldHabValor01},
				{sheet.fldCBHab02, sheet.fldHabValor02},
				{sheet.fldCBHab03, sheet.fldHabValor03},
				{sheet.fldCBHab04, sheet.fldHabValor04},
				{sheet.fldCBHab05, sheet.fldHabValor05},
				{sheet.fldCBHab06, sheet.fldHabValor06},
				{sheet.fldCBHab07, sheet.fldHabValor07},
				{sheet.fldCBHab08, sheet.fldHabValor08},
				{sheet.fldCBHab09, sheet.fldHabValor09},
				{sheet.fldCBHab10, sheet.fldHabValor10},
				{sheet.fldCBHab11, sheet.fldHabValor11},
				{sheet.fldCBHab12, sheet.fldHabValor12},
				{sheet.fldCBHab13, sheet.fldHabValor13},
				{sheet.fldCBHab14, sheet.fldHabValor14},
				{sheet.fldCBHab15, sheet.fldHabValor15},
				{sheet.fldCBHab16, sheet.fldHabValor16},
				{sheet.fldCBHab17, sheet.fldHabValor17},
				{sheet.fldCBHab18, sheet.fldHabValor18},
				{sheet.fldCBHab19, sheet.fldHabValor19},
				{sheet.fldCBHab20, sheet.fldHabValor20},
				{sheet.fldCBHab21, sheet.fldHabValor21},
				{sheet.fldCBHab22, sheet.fldHabValor22},
				{sheet.fldCBHab23, sheet.fldHabValor23},
				{sheet.fldCBHab24, sheet.fldHabValor24},
				{sheet.fldCBHab25, sheet.fldHabValor25},
				{sheet.fldCBHab26, sheet.fldHabValor26},
				{sheet.fldCBHab27, sheet.fldHabValor27},
				{sheet.fldCBHab28, sheet.fldHabValor28},
				{sheet.fldCBHab29, sheet.fldHabValor29},
				{sheet.fldCBHab30, sheet.fldHabValor30},
				{sheet.fldCBHab31, sheet.fldHabValor31},
				{sheet.fldCBHab32, sheet.fldHabValor32},
				{sheet.fldCBHab33, sheet.fldHabValor33},
				{sheet.fldCBHab34, sheet.fldHabValor34},
				{sheet.fldCBHab35, sheet.fldHabValor35},
				{sheet.fldCBHab36, sheet.fldHabValor36},
				{sheet.fldCBHab37, sheet.fldHabValor37},
				{sheet.fldCBHab38, sheet.fldHabValor38},
				{sheet.fldCBHab39, sheet.fldHabValor39}, 
				{sheet.fldCBHab40, sheet.fldHabValor40}, 
				{sheet.fldCBHab41, sheet.fldHabValor41}, 
				{sheet.fldCBHab42, sheet.fldHabValor42}, 
				{sheet.fldCBHab43, sheet.fldHabValor43}, 
				{sheet.fldCBHab44, sheet.fldHabValor44}, 
				{sheet.fldCBHab45, sheet.fldHabValor45} 
			}
			
			-- INDEXANDO VIRTUDES
			local tbVirtudes = {
				sheet.fldValCastidade, sheet.fldValLuxuria,
				sheet.fldValEnergia, sheet.fldValPreguica,
				sheet.fldValPerdao, sheet.fldValVinganca,
				sheet.fldValGenerosidade, sheet.fldValEgoismo,
				sheet.fldValHonestidade, sheet.fldValMalicia,
				sheet.fldValJustica, sheet.fldValArbitrariedade,
				sheet.fldValMisericordia, sheet.fldValCrueldade,
				sheet.fldValModestia, sheet.fldValOrgulho,
				sheet.fldValEspiritualidade, sheet.fldValCinismo,
				sheet.fldValPrudencia, sheet.fldValImprudencia,
				sheet.fldValTemperanca, sheet.fldValIndulgencia,
				sheet.fldValConfianca, sheet.fldValDesconfianca,
				sheet.fldValCoragem, sheet.fldValCovardia
			}
			
			-- SOMANDO HABILIDADES CAVALEIRESCAS
			for i = 1, #tbHabilidades do
				if(tbHabilidades[i][1] == "C" and tonumber(tbHabilidades[i][2]) > 15) then SomaHabs = SomaHabs + tbHabilidades[i][2]; end;
			end;
			
			-- SOMANDO VIRTUDES ELEVADAS
			for i = 1, #tbVirtudes do
				if(tonumber((tbVirtudes[i]) or 0) > 15) then SomaVirts = SomaVirts + tonumber(tbVirtudes[i]); end;
			end;
			
			-- CHECANDO BONUS DIVERSOS
			if(self.flagHonra.visible == true) then
				SomaBonus = SomaBonus + 100;
			end;
			if(self.flagReli.visible == true) then
				SomaBonus = SomaBonus + 100;
			end;
			if(self.flagRom.visible == true) then
				SomaBonus = SomaBonus + 100;
			end;
			
			-- SOMANDO BONUS DIVERSOS
			SomaBonus = SomaBonus + (tonumber(node.countSum) or 0);
			
			-- APLICANDO VALOR AO CAMPO
			sheet.fldSomaGloria = "+ " .. tostring(math.floor(SomaHabs + SomaVirts + SomaBonus));
		end;	
	]]>
	</script>
	
	<style>
	label.NLabel {
		fontStyle: bold;
		fontColor: white;
		fontFamily: Cambria;
		fontSize: 14;
		align: left;
		}
		
	label.NLabelG {
		fontColor: #6f6f6f;
		fontFamily: Cambria;
		fontSize: 14;
		align: left;
		}

	edit.GEdit {
		fontColor: #cdcdcd;
		fontFamily: Cambria;
		fontSize: 14;
		height: 30;
		transparent: true;
		}

	edit.GEditV {
		fontStyle: bold;
		fontColor: white;
		fontFamily: Cambria;
		fontSize: 14;
		transparent: true;
		height: 20;
		}
		
	edit.GEditH {
		fontColor: #cdcdcd;
		fontFamily: Cambria;
		fontSize: 14;
		transparent: true;
		height: 30;
		}

	label.GEditH {
		fontColor: #6f6f6f;
		fontFamily: Cambria;
		fontSize: 14;
		height: 30;
		top: 1;
		}

	edit.ELabel {
		fontStyle: bold;
		fontColor: white;
		fontFamily: Cambria;
		fontSize: 14;
		align: left;
		width: 140;
		transparent: true;
		}

	edit.EAtr{
		text: 00;
		width: 66;
		align: left;
		fontStyle: bold;
		fontColor: white;
		fontFamily: Cambria;
		fontSize: 47;
		horzTextAlign: center;
		type: number;
		min: 0;
		max: 99;
		transparent: true;
	}

	layout.LConjunto{
		align: top;
		height: 30;
		}

	layout.LConjuntoH{
		align: top;
		height: 30;
		}
		
	rectangle.LConjuntoH{
		align: top;
		height: 30;
		color: #272727;
		padding: {left=40};
		}

	layout.LColuna{	
		width: 209;
		align: left;
		}
		
	layout.LColuna3{	
		width: 250;
		align: left;
		}

	rectangle.RBackground{
		align: client;
		color: #272727;
		padding: {top = 20};
		}

	comboBox.CHab{
		width: 35; 
		align: left; 
	}

	edit.ENomePJ{
		transparent: true;
		fontStyle: bold;
		fontColor: #0080ff;
		fontFamily: Palatino Linotype;
		fontSize: 26; 
		textTrimming: character;
		width: 700; 
		left: 35;
	}

	edit.EJogador{
		transparent: true;
		fontStyle: bold;
		fontColor: white;
		fontFamily: Palatino Linotype;
		fontSize: 13;
		textTrimming: character;
		width: 700;
		height: 33;
		top: 33;
		left: 37;
	}
	</style>
	<rectangle class="RBackground">
		<scrollBox align="client">
			<!-- IMAGENS DA BORDA DECORATIVA -->
			<image left="20" width = "291" height="217.5" url="/images/Dragon.png" style="proportional"/>
			<image left="33" top="-23" width = "623" height="534.5" url="/images/trail.png" style="proportional"/>
			<image left="120" top="110" width = "60" height="1516" url="/images/Border-short.png" style="proportional"/>
			<image left="300" height="22" url="/images/star.png" style="proportional"/>
			<image left="330" top="80" height="22" url="/images/star.png" style="proportional"/>
			<image left="400" top="40" height="22" url="/images/star.png" style="proportional"/>
			<image left="470" top="0" height="18" url="/images/star.png" style="proportional"/>
			<image left="540" top="60" height="22" url="/images/star.png" style="proportional"/>
			<image left="600" top="15" height="18" url="/images/star.png" style="proportional"/>
			<image left="670" top="68" height="22" url="/images/star.png" style="proportional"/>
			<image left="900" top="30" height="20" url="/images/star.png" style="proportional"/>
			<image left="0" top="230" height="22" url="/images/star.png" style="proportional"/>
			<image left="40" top="290" height="15" url="/images/star.png" style="proportional"/>
			<image left="10" top="360" height="22" url="/images/star.png" style="proportional"/>
			<image left="45" top="390" height="22" url="/images/star.png" style="proportional"/>
			<image left="0" top="480" height="15" url="/images/star.png" style="proportional"/>
			<image left="15" top="610" height="18" url="/images/star.png" style="proportional"/>
			<image left="22" top="850" height="15" url="/images/star.png" style="proportional"/>
			<image left="390" top="72" height="12" width="14" url="/images/shine.png" />
			<image left="480" top="65" height="12" width="14" url="/images/shine.png" />
			<image left="587" top="30" height="12" width="14" url="/images/shine.png" />
			<image left="667" top="0" height="12" width="14" url="/images/shine.png" />
			<image left="745" top="50" height="12" width="14" url="/images/shine.png" />
			<image left="850" top="0" height="12" width="14" url="/images/shine.png" />
			<image left="90" top="250" height="12" width="14" url="/images/shine.png" />
			<image left="50" top="310" height="12" width="14" url="/images/shine.png" />
			<image left="60" top="420" height="12" width="14" url="/images/shine.png" />
			<image left="80" top="560" height="12" width="14" url="/images/shine.png" />
			<image left="55" top="700" height="12" width="14" url="/images/shine.png" />
			<image left="80" top="740" height="12" width="14" url="/images/shine.png" />
			
			<layout margins="{left = 185, top = 110}" align="top" height="1800">
				 <!-- INÍCIO DAS ABAS -->
				<tabControl align="client">
				
					<!-- ABA DADOS -->
					<tab title="Dados">
						<import file="sheet_Pendragon_dados.lfm"/>
					</tab>
					
					<!-- ABA TRAÇOS E PAIXÕES -->
					<tab title="Traços e Paixões">
						<import file="sheet_Pendragon_tEp.lfm"/>
					</tab>
					
					<!-- ABA EQUIPAMENTO -->
					<tab title="Equipamento">
						<import file="sheet_Pendragon_equipamento.lfm"/>
					</tab>
					
					<!-- ABA HISTÓRIA -->
					<tab title="História">
						<import file="sheet_Pendragon_historia.xml"/>
					</tab>
					
					<!-- ABA ANOTAÇÕES -->
					<tab title="Anotações">
						<rectangle class="RBackground" padding="{top = 0}">
							<richEdit align="client" backgroundColor="#272727" defaultFontColor="#cdcdcd" field="anotacoes" />
						</rectangle>
					</tab>
				</tabControl>		
			</layout>
		</scrollBox>
	</rectangle>
</form>